# システムの設計

時系列データの分析のための可視化を表示しつつ、情報を手に入れたい地理的範囲や指標の選択に応じた情報を文章としてユーザに提供するためにシステムを設計した。
このときSPiデータを時系列データとして分析するときに、ユーザーは地理的な階層(東アジアの中の日本やヨーロッパの中のイギリスなど)の情報を含んでデータを分析したいと仮定している。
しかしSPIデータには地理的な階層の情報が含まれていないので、[国際連合](https://www.un.org/)が提供している、地理的な階層についてのデータ[@unsd2003united]を追加で扱う。

<!--                      要件                             -->

## 要件

実際にシステムを作る前に、以下のように要件を定める。

**R1 変化の特定** 指標の値が極端に低い国に注目するときに表示する地理的範囲が広い(表示する国数が多い)と、注目する国のデータが潰れて表示されてしまい、そのデータの分析は困難になる。
そこで10年の時系列データの中で傾向の変化があった年を特定して、データのの概要としてユーザーに提供する必要がある。

**R2 階層的な情報** 生データをそのまま分析するとき、個々の国についての情報を分析することはできないが、その階層的な見方はなかなか難しい。

**R3 地理的範囲の表示** 地理的階層の情報を伝える際にどの国がその範囲に含まれているかをユーザーが知っている必要がある。
しかし、ある範囲に含まれる国を全てユーザーが知っていることはほとんどない。
そのため、選択する地理的範囲を資格的にユーザーに提供する必要がある。

**R4 概要** 複数のデータに対し、時系列データの変化や地理情報、階層的な情報などを視覚的な表現によって理解することは困難である。
そこでその表示しているデータの概要を、文章によってユーザーに提供する必要がある。

<!--                        可視化について                -->

## データの可視化

### 時系列の可視化

時系列データの可視化は折れ線やヒートマップを使って行うのが一般的である。
本論文では折れ線を用いてSPIデータの時間的変化を表現する。
しかし注目する地域的範囲が広いときに、ほとんどの折れ線では時間的な変動を認識することができない。
注目する国の概要やその国データと類似した国データをハイライトする。
注目する国に関してはデータの傾向が変化する点をドットを用いて表現しつつ(**R1**)、色を他の表現と異なるマゼンタ色を使う。
注目する国と類似する国のデータに関してカーキ色を使う。

**傾向の変化する点** データの傾向の変化する点の求める方法ははJunhuaたち[@lu2020illustrating]と同様にWin法[@truong2020selective]を適用する。
時系列データを$(x_1,x_2,...,x_n)$として初めに、$1\leq i\leq n-1$に対して$(x_{i},x_{i+1})$の線形回帰直線の傾き$m^{(1)}_i$を求め、$1\leq i\leq n-2$に対して$(x_{i},x_{i+1},x_{i+2})$の線形回帰直線の傾き$m^{(2)}_i$を求める。
次に$j=1,2$、$1\leq i\leq n-1-j$に対して$d^{(j)}_i=|m^{(j)}_{i+1}-m^{(j)}_{i}|$を求める。
そして$j=1,2$両方ともに対して、$d^{(j)}_i$が注目する指標に対するSPIデータの平均値を元にした閾値以上であるとき、$x_{i+1}$の点をデータの傾向が変化した点として捉える。
これは、ある点をを中心にして左右の直近のデータの傾きの差が大きい点を傾向の変化があった点としている。
$d^{(1)}_i$は短い時間間隔でのデータの変化を捉えることができ、$d^{(2)}_i$は少し長い時間間隔でのデータの変化を捉えることができる。

**類似する国** 類似する国を定義する。
初めに注目する国と他の国の時系列データで相関係数が大きい国を集める。
その集合の中で、注目する国と他の国データでユークリッド距離を計算する。
その距離が注目する指標に対するSPIデータの平均値を元にした閾値未満であれば、類似する国とする。
相関係数は、二つの時系列データの上昇や現象などの大まかな変動が一致していることを条件にするために使用している。
その後時系列データを$n$次元ベクトルと考え、ユークリッド距離が近いデータを選択することで、注目する国と値が近く似た変動をする国を抽出することができる。

## 地域の可視化

選択された地域的範囲をユーザーが難なく理解できるように、世界地図を用いてその範囲を表示する(**R3**)。
選択された地理的範囲に含まれていない国々と、データが存在しない国は灰色で表される。
注目する国については、折れ線と同様の色で表現する。
これらによって、ユーザーが注目する国と地理的範囲の国々とで地理的比較が可能になっている。


<!--                 文章生成について                       -->
## 文章生成



<!--                 インタラクションについて                             -->
## インタラクション

ユーザーがより可視化からデータに関する情報を手に入れやすいようにインタラクションを導入する。

**ズーム** 折れ線の表示において、注目したい国データの変動をより詳細にみたいときのために、ボタンによって縦軸の幅を調整できるようにしている。その他にも、選択した地理的範囲がアジアや南アメリカなど世界全体ではないときに、その選択した地理的範囲のデータだけを表す縦軸にするか世界のデータの範囲を縦軸にするかを調整するボタンも準備している。
選択した地理的範囲を見ることは、世界から比べて極端に値が小さい、または大きい国しかその地理的範囲に存在しないときに、その国々のデータを確認するのに役立つ。
一方世界のデータの範囲を縦軸にすることで、世界から比べて極端に値の低い、または大きい国がその選択した地理的範囲に含まれていることなどを知ることができる。

**フィルタリング** 


**クエリ** 


**関連付け** 


**パラメータ選択** 

ぼたん
折れ線/国選択



<!--                    システム                        -->

## システム

